<!DOCTYPE html>
<html lang="zh">
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Cosmetics Scanner - 查看详情</title>
<meta name="robots" content="noindex, nofollow">
<script src="https://cdn.jsdelivr.net/npm/@ericblade/quagga2/dist/quagga.min.js"></script>
<style>
  body{margin:0;background:linear-gradient(180deg,#fff5f8 0%,#ffeaf1 100%);color:#d63384;
  font-family:"Segoe UI","Microsoft YaHei",sans-serif;text-align:center;}
  h2{margin-top:16px;color:#d63384;}
  #scanner-container{position:relative;width:90vw;height:45vh;margin:20px auto;
  border:2px solid rgba(255,105,180,0.4);border-radius:12px;box-shadow:0 0 10px rgba(255,182,193,0.6);overflow:hidden;}
  video{width:100%;height:100%;object-fit:cover;}
  .corner{position:absolute;width:30px;height:30px;border:3px solid #ff69b4;}
  .top-left{top:0;left:0;border-right:none;border-bottom:none;}
  .top-right{top:0;right:0;border-left:none;border-bottom:none;}
  .bottom-left{bottom:0;left:0;border-right:none;border-top:none;}
  .bottom-right{bottom:0;right:0;border-left:none;border-top:none;}
  .center-line{position:absolute;top:50%;left:0;width:100%;height:2px;background-color:#ff69b4;transform:translateY(-50%);}
  #result{font-size:1.3em;margin:20px 0;font-weight:600;}
</style></head>
<body>
<h2>查看详情扫码</h2>
<div id="scanner-container"><video id="video"></video>
<div class="corner top-left"></div><div class="corner top-right"></div><div class="corner bottom-left"></div><div class="corner bottom-right"></div><div class="center-line"></div></div>
<div id="result">等待扫描中...</div>
<audio id="beep-sound" src="https://actions.google.com/sounds/v1/alarms/beep_short.ogg" preload="auto"></audio>
<script>
const appId="c2893944-c589-4385-833c-17a86cc10826";const view="Procurment_Detail";let lastCode="";
function startScanner(){
Quagga.init({inputStream:{type:"LiveStream",target:document.querySelector("#scanner-container"),constraints:{facingMode:"environment"}},decoder:{readers:["code_128_reader"]}},
err=>{if(err){document.getElementById('result').innerText="无法启动摄像头";return;}
Quagga.start();document.getElementById('result').innerText="请将条码置于粉色框内扫描...";});
Quagga.onDetected(res=>{const code=res.codeResult.code;if(code&&code!==lastCode){lastCode=code;document.getElementById('result').innerText="识别成功："+code;
const beep=document.getElementById("beep-sound");beep.currentTime=0;beep.play().catch(()=>{});openAppSheet(view,code);}});}
function openAppSheet(view,code){
const encoded=encodeURIComponent(`{"Code":"${code}"}`);const appURL=`appsheet://app?appId=${appId}#view=${view}&defaults=${encoded}`;
const webURL=`https://www.appsheet.com/start/${appId}#view=${view}&defaults=${encoded}`;
const iframe=document.createElement("iframe");iframe.style.display="none";iframe.src=appURL;document.body.appendChild(iframe);
setTimeout(()=>window.location.href=webURL,1500);}
startScanner();
</script>
</body>
</html>
