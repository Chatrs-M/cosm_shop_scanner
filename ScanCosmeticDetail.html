<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Batch Scanner</title>

<!-- 官方 CDN：确保 GitHub Pages 可用 -->
<script src="https://unpkg.com/html5-qrcode" type="text/javascript"></script>

<style>
    body {
        font-family: sans-serif;
        margin: 0;
        padding: 15px;
        background: #fff;
    }
    #reader {
        width: 100%;
        max-width: 400px;
        margin: auto;
    }
    #resultBox {
        margin-top: 20px;
        padding: 10px;
        border: 2px solid #888;
        border-radius: 10px;
        background: #f8f8f8;
        font-size: 20px;
        text-align: center;
    }
    button {
        margin-top: 20px;
        width: 100%;
        padding: 15px;
        font-size: 20px;
        border: none;
        border-radius: 8px;
        background: #4CAF50;
        color: white;
    }
</style>
</head>

<body>
<h2>Scan Batch Code</h2>

<div id="reader"></div>

<div id="resultBox">Waiting for scan...</div>

<button id="confirmBtn">确认并打开 AppSheet</button>

<script>
let scannedCode = "";
const appId = "c2893944-c589-4385-833c-17a86cc10826";
const viewName = "Batches_Detail";

// 初始化扫描器
function startScanner() {
    const html5QrCode = new Html5Qrcode("reader");

    const config = {
        fps: 10,
        qrbox: { width: 250, height: 250 }
    };

    html5QrCode.start(
        { facingMode: "environment" },
        config,
        (decodedText) => {
            scannedCode = decodedText.trim();
            document.getElementById("resultBox").innerText = "Scanned: " + scannedCode;
        },
        (errorMessage) => {}
    ).catch(err => {
        document.getElementById("resultBox").innerText =
            "摄像头启动失败：" + err;
    });
}

// 按下确认按钮 → 跳 AppSheet Detail
document.getElementById("confirmBtn").onclick = function () {
    if (!scannedCode) {
        alert("请先扫描条码！");
        return;
    }

    const url = `https://www.appsheet.com/start/${appId}#control=${viewName}&row=${scannedCode}`;
    window.location.href = url;
};

// 立即启动摄像头
startScanner();
</script>
</body>
</html>
